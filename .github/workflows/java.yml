name: Build and Deploy

on:
  push:
    branches:
      - main

jobs:
  build:
    runs-on: test_runner
    container:
      image: techiescamp/java-agent:2.0.0

    steps:

      - name: Checkout Code
        uses: actions/checkout@v2

      - name: Build Docker Image
        uses: aevea/action-kaniko@master
        with:
          image: gcr.io/kaniko-project/executor:latest
          args: >-
            --dockerfile=/Dockerfile.test
            --context=git://github.com/kubernetes-learning-projects/kube-petclinc-app
            --destination=814200988517.dkr.ecr.us-west-2.amazonaws.com/pet-clinic:6.0.0